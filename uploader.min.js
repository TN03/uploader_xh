/**
 * Copyright 2017 Christoph M. Becker
 *
 * This file is part of Uploader_XH.
 *
 * Uploader_XH is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Uploader_XH is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with Uploader_XH.  If not, see <http://www.gnu.org/licenses/>.
 */

var uploader = uploader || {};

uploader.init = {
    PostInit: function(uploader) {
        document.getElementById('filelist').innerHTML = '';

        document.getElementById('uploadfiles').onclick = function() {
            uploader.start();
            return false;
        };
    },
    FilesAdded: function(up, files) {
        plupload.each(files, function(file) {
            document.getElementById('filelist').innerHTML += '<div id="' + file.id + '">' + file.name + ' (' + plupload.formatSize(file.size) + ') <b></b></div>';
        });
    },
    UploadProgress: function(up, file) {
        document.getElementById(file.id).getElementsByTagName('b')[0].innerHTML = '<span>' + file.percent + "%</span>";
    },

    Error: function(up, err) {
        document.getElementById('console').innerHTML += "\nError #" + err.code + ": " + err.message;
    }
};

(function () {
    function relocate() {
        var url = this.getAttribute("data-url");
        url += encodeURIComponent(this.value);
        location.href = url;
    };

    var ids = ["uploader-type", "uploader-subdir", "uploader-resize"];
    for (var i = 0; i < ids.length; i++) {
        var element = document.getElementById(ids[i]);
        if (element) {
            element.onchange = relocate;
        }
    }

    if (uploader_config) {
       	uploader_config.init = uploader.init;
        new plupload.Uploader(uploader_config).init();
    }
}());
